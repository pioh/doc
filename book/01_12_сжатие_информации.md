[← К оглавлению](README.md)

---

# [Глава 1.12](01_12_сжатие_информации.md): Способы сжатия информации

## Введение

Представь: ты качаешь фильм на 20 гигабайт. А теперь представь, что он весил бы 200 гигабайт без сжатия. Сжатие информации — это магия, которая экономит место на диске, трафик интернета и твои нервы. Но за всё приходится платить: либо временем на распаковку, либо качеством.

Эта глава связана с предыдущими темами:
- [**[Глава 1.3](01_03_представление_звуковых_данных.md)**](01_03_представление_звуковых_данных.md) (звуковые данные) — форматы MP3, AAC, Opus используют сжатие с потерями
- [**[Глава 1.4](01_04_представление_символьных_данных.md)**](01_04_представление_символьных_данных.md) (символьные данные) — кодировки UTF-8 уже содержат элементы сжатия
- [**[Глава 1.8](01_08_представление_графических_данных.md)**](01_08_представление_графических_данных.md) (графические данные) — форматы JPEG, PNG, WebP используют различные алгоритмы сжатия

Сжатие бывает двух типов: **без потерь** (lossless) и **с потерями** (lossy). Первое — как положить вещи в чемодан аккуратно, второе — как выкинуть половину вещей и сказать "и так сойдёт". Погнали разбираться.

## Основные понятия

### Что такое сжатие данных

**Сжатие данных (data compression)** — это процесс уменьшения объёма информации путём устранения избыточности или менее значимых деталей.

**Избыточность** — это повторяющиеся или предсказуемые части данных, которые можно закодировать более компактно. Например, фраза "аааааааааа" занимает 10 байт, но можно записать как "10×а" и сэкономить место.

### Степень и коэффициент сжатия

**Степень сжатия (compression ratio)** — отношение размера исходного файла к размеру сжатого файла:

```
Степень сжатия = Размер исходного / Размер сжатого
```

Чем больше число — тем лучше сжатие.

**Коэффициент сжатия** — обратная величина, показывает во сколько раз уменьшился размер:

```
Коэффициент сжатия = Размер сжатого / Размер исходного × 100%
```

Чем меньше процент — тем лучше.

**Пример 1**: Файл размером 100 МБ сжат до 25 МБ.

```
Степень сжатия = 100 МБ / 25 МБ = 4:1 (или просто "4")
Коэффициент сжатия = 25 МБ / 100 МБ × 100% = 25%
```

Говорим: "Файл сжат в 4 раза" или "Файл занимает 25% от оригинала".

### Два типа сжатия

**Сжатие без потерь (lossless compression)** — после распаковки получаешь **точно такие же данные**, бит в бит. Используется для текста, программ, баз данных — там, где потеря даже одного бита критична.

**Сжатие с потерями (lossy compression)** — после распаковки данные **немного (или сильно) отличаются** от оригинала. Используется для мультимедиа (фото, звук, видео), где человек не заметит небольших потерь.

## Алгоритмы сжатия без потерь

### RLE (Run-Length Encoding) — для ленивых

**RLE** — простейший алгоритм: заменяет повторяющиеся символы на пару "количество + символ".

**Как работает**:

Исходная строка: `AAAABBCCCCCCD`

Сжатая: `4A2B6C1D`

Вместо 13 символов получили 8. Профит!

**Пример 2**: Сжать строку "WWWWWWWWWBBBWWW"

```
Исходная строка: WWWWWWWWWBBBWWW (15 символов)
Сжатая строка:   9W3B3W          (6 символов + числа)
```

Если считать, что каждое число занимает 1 байт, а символ 1 байт:
- Исходный размер: 15 байт
- Сжатый размер: 6 байт (3 пары "число+символ")
- Степень сжатия: 15/6 = 2.5

**Где используется**:
- Факсы (чёрно-белые изображения с длинными полосами)
- Простые графические форматы (BMP)
- Форматы PCX, TIFF (с опцией RLE)

**Минус**: Если повторов мало, файл может даже **увеличиться**. Например, строка "ABCDEFG" превратится в "1A1B1C1D1E1F1G" — в 2 раза длиннее. Облом.

### Кодирование Хаффмана — классика жанра

**Алгоритм Хаффмана (Huffman Coding)** — присваивает часто встречающимся символам короткие коды, а редким — длинные. Это как в азбуке Морзе: буква "E" в английском — это точка (.), а "Q" — тире-тире-точка-тире (--·-).

**Пример 3**: Сжать строку "ABRACADABRA" (11 символов)

Частота символов:
- A: 5 раз
- B: 2 раза
- R: 2 раза
- C: 1 раз
- D: 1 раз

Строим дерево Хаффмана и присваиваем коды:
- A: `0` (самый частый)
- B: `10`
- R: `110`
- C: `1110`
- D: `1111`

Закодированная строка:
```
A  B  R  A  C  A  D  A  B  R  A
0  10 110 0 1110 0 1111 0 10 110 0
```

Итого: `0101100111001111010110­0` = 23 бита = 2.875 байта

Исходная строка в ASCII (8 бит на символ): 11 × 8 = 88 бит = 11 байт

Степень сжатия: 11 / 2.875 ≈ 3.8

**Где используется**:
- ZIP, GZIP, RAR (как часть более сложных алгоритмов)
- JPEG (для кодирования коэффициентов DCT)
- MP3, AAC (тоже как часть)

**Минус**: Нужно хранить таблицу кодов вместе с данными, что добавляет накладные расходы. Для маленьких файлов может быть невыгодно.

### LZW (Lempel-Ziv-Welch) — для умных

**LZW** — алгоритм, который строит словарь повторяющихся последовательностей символов прямо в процессе сжатия. Не нужно заранее знать, что будет повторяться.

**Как работает**:

Начинаем со словаря одиночных символов (A=1, B=2, C=3...). При встрече новой комбинации добавляем её в словарь и используем дальше.

**Пример 4**: Сжать строку "ABABABAB"

```
Шаг 1: Читаем "A" → код 65 (ASCII), словарь: {}
Шаг 2: Читаем "B" → код 66, словарь: {AB: 256}
Шаг 3: Читаем "AB" → код 256 (уже в словаре!), словарь: {AB: 256, ABA: 257}
Шаг 4: Читаем "AB" → код 256, словарь: {AB: 256, ABA: 257, ABAB: 258}
```

Результат: `65 66 256 256` (4 числа вместо 8 символов)

**Где используется**:
- GIF (графический формат)
- TIFF (с опцией LZW)
- Старые модемы (V.42bis)
- Unix-утилита `compress`

**Минус**: Словарь может стать огромным, нужно ограничивать его размер или периодически сбрасывать.

### Deflate (LZ77 + Huffman) — царь архиваторов

**Deflate** — комбинация алгоритма LZ77 (поиск повторяющихся последовательностей) и кодирования Хаффмана. Это основа для ZIP, GZIP, PNG.

**Как работает LZ77**:

Ищет повторяющиеся последовательности и заменяет их ссылками типа "повтори 5 символов, которые были 12 позиций назад".

**Пример 5**: Сжать строку "blablablabla"

```
b l a b l a b l a b l a
```

После "bla" встречается повтор:
```
bla → буквально
bla → ссылка (назад 3, длина 3)
bla → ссылка (назад 3, длина 3)
bla → ссылка (назад 3, длина 3)
```

Вместо 12 символов: `bla` + 3 ссылки (каждая ~2 байта) = 3 + 6 = 9 байт (условно)

**Где используется**:
- **ZIP** — архиватор по умолчанию
- **GZIP** — сжатие в HTTP (когда качаешь сайты)
- **PNG** — сжатие графики без потерь
- **ZLIB** — библиотека сжатия

**Плюсы**: Быстро, хорошая степень сжатия, широко поддерживается.

### LZMA (Lempel-Ziv-Markov chain Algorithm) — монстр сжатия

**LZMA** — очень мощный алгоритм, используется в 7-Zip. Сжимает лучше Deflate, но медленнее.

**Пример 6**: Сравнение сжатия одного файла (10 МБ текста)

| Алгоритм | Размер сжатого | Время сжатия | Степень сжатия |
|----------|----------------|--------------|----------------|
| ZIP (Deflate) | 3.2 МБ | 2 сек | 3.1 |
| 7-Zip (LZMA) | 2.1 МБ | 8 сек | 4.8 |
| RAR | 2.4 МБ | 5 сек | 4.2 |

**Где используется**:
- **7-Zip (.7z)** — популярный архиватор
- **XZ** — сжатие в Linux (архивы .tar.xz)

**Минус**: Жрёт память и время. Для быстрого сжатия лучше ZIP.

## Алгоритмы сжатия с потерями

А теперь перейдём к тёмной стороне — форматам, которые выкидывают "ненужное". Спойлер: ненужное решают они, а не ты.

### JPEG — когда пиксели не важны

**JPEG (Joint Photographic Experts Group)** — стандарт сжатия фотографий. Выкидывает мелкие детали, которые глаз не заметит (ну, в теории).

**Как работает**:
1. Делит изображение на блоки 8×8 пикселей
2. Применяет дискретное косинусное преобразование (DCT)
3. Квантует высокочастотные компоненты (= выкидывает детали)
4. Сжимает получившиеся данные алгоритмом Хаффмана

**Пример 7**: Фотография 4000×3000 пикселей, 24 бита на пиксель (RGB)

```
Размер без сжатия:
4000 × 3000 × 3 байта = 36 000 000 байт = 34.3 МБ

Размер JPEG (качество 90%):
~ 2.5 МБ

Степень сжатия: 34.3 / 2.5 ≈ 13.7
```

**Где используется**:
- Фотографии в интернете
- Цифровые камеры (по умолчанию)
- Почти везде, где есть картинки

**Минусы**:
- При каждом пересохранении качество падает (привет, мемы 2010 года с 5 пикселями)
- Плохо сжимает текст и чёткие линии (появляются артефакты)
- Не поддерживает прозрачность

**Правило**: Используй JPEG для фото, PNG для скриншотов и графики.

### MP3, AAC, Opus — когда уши не услышат

**MP3 (MPEG-1 Audio Layer 3)** — легендарный формат сжатия звука. Выкидывает частоты, которые человек якобы не слышит.

**Как работает**:
1. Разбивает звук на частоты (преобразование Фурье)
2. Применяет психоакустическую модель (определяет, что можно выкинуть)
3. Квантует и кодирует оставшееся

**Пример 8**: Песня 3 минуты, стерео, 44.1 кГц, 16 бит

```
Размер WAV (без сжатия):
3 минуты × 60 сек × 44100 Гц × 2 канала × 2 байта = 31 752 000 байт ≈ 30.3 МБ

Размер MP3 (320 кбит/с):
320 кбит/с × 180 сек / 8 = 7 200 000 байт ≈ 6.9 МБ

Степень сжатия: 30.3 / 6.9 ≈ 4.4
```

**Современные альтернативы**:
- **AAC** (используется в Apple Music, YouTube) — лучше MP3 при тех же битрейтах
- **Opus** (используется в Discord, WhatsApp) — лучше всех для голоса и музыки

**Минус**: Аудиофилы будут плакать и говорить про "потерю тёплого лампового звука". Обычный человек не услышит разницы при 256+ кбит/с.

### H.264, H.265 (HEVC) — сжатие видео

**H.264 (AVC)** — стандарт сжатия видео. Используется в YouTube, Netflix, Blu-ray.

**Как работает**:
1. Делит кадры на типы: I-кадры (ключевые, сжаты как JPEG), P-кадры (предсказание от предыдущего), B-кадры (предсказание от прошлого и будущего)
2. Сохраняет только изменения между кадрами
3. Применяет внутрикадровое сжатие (похоже на JPEG)

**Пример 9**: Видео FullHD (1920×1080), 60 FPS, 10 минут

```
Размер без сжатия:
1920 × 1080 × 3 байта × 60 FPS × 600 сек = 373 248 000 000 байт ≈ 347 ГБ (!)

Размер H.264 (битрейт 8 Мбит/с):
8 Мбит/с × 600 сек / 8 = 600 000 000 байт ≈ 572 МБ

Степень сжатия: 347000 / 572 ≈ 606
```

Да, **в 600 раз**. Вот почему ты можешь смотреть видео онлайн.

**H.265 (HEVC)** — новый стандарт, сжимает в 2 раза лучше H.264, но требует больше ресурсов для декодирования.

**Где используется**:
- YouTube, Twitch, Netflix
- Blu-ray диски
- Все видеозвонки (Zoom, Skype)

## Сравнение алгоритмов

### Таблица: Когда что использовать

| Тип данных | Без потерь | С потерями |
|------------|------------|------------|
| Текст, код, документы | **ZIP, 7-Zip, GZIP** | Нельзя |
| Фотографии | PNG, WebP (lossless) | **JPEG, WebP** |
| Скриншоты, графика | **PNG** | JPEG (плохо) |
| Музыка | FLAC, ALAC | **MP3, AAC, Opus** |
| Видео | Huffyuv, FFV1 (редко) | **H.264, H.265, VP9, AV1** |
| Базы данных | ZIP, LZMA | Нельзя |

### Практические советы

1. **Для хранения важных данных** (документы, код, базы данных) — только без потерь (ZIP, 7-Zip).

2. **Для фотографий** — JPEG при экспорте, RAW или TIFF при обработке.

3. **Для скриншотов** — PNG, НИКОГДА не JPEG (будет мыло).

4. **Для музыки** — FLAC если место есть, AAC/Opus если жалко диск.

5. **Для видео** — H.264 для совместимости, H.265 если устройство поддерживает, AV1 для будущего.

6. **Не пересохраняй lossy форматы** — каждое пересохранение теряет качество. Храни оригиналы.

## Парадоксы и приколы сжатия

### Парадокс: можно ли сжать всё до 1 байта?

**Нет.** Это доказывается теорией информации (привет, Клод Шеннон из [Глава 1.5](01_05_меры_информации.md)).

**Доказательство для чайников**:

Допустим, мы можем любой файл сжать до 1 байта. Байт — это 256 вариантов (0-255). Значит, существует максимум 256 различных сжатых файлов. Но несжатых файлов бесконечно много. Значит, несколько разных файлов должны сжаться в один и тот же код. А как их потом различить при распаковке? Никак. Парадокс.

**Вывод**: Идеального алгоритма сжатия не существует. Любой алгоритм хорошо работает только для определённого типа данных.

### Сжатие случайных данных

Попробуй сжать случайный шум или уже сжатый файл — получишь файл **большего размера**, чем исходный. Алгоритм будет пытаться найти закономерности, не найдёт, но добавит свои метаданные (заголовки, словари). В итоге — антисжатие.

**Пример 10**: Попытка сжать архив

```
Файл randomdata.bin: 10 МБ (случайные байты)
Сжатие ZIP: randomdata.zip = 10.1 МБ

Увеличился на 0.1 МБ из-за заголовков ZIP.
```

**Правило**: Не архивируй уже сжатые файлы (.jpg, .mp3, .mp4, .zip). Толку ноль, только время потеряешь.

## Ключевые термины и определения

**Сжатие данных** — процесс уменьшения объёма информации путём устранения избыточности.

**Сжатие без потерь (lossless)** — метод сжатия, при котором исходные данные восстанавливаются полностью.

**Сжатие с потерями (lossy)** — метод сжатия, при котором часть данных удаляется безвозвратно для достижения большей степени сжатия.

**Избыточность** — повторяющиеся или предсказуемые части данных, которые можно закодировать компактнее.

**Степень сжатия (compression ratio)** — отношение размера исходного файла к размеру сжатого (чем больше, тем лучше).

**RLE (Run-Length Encoding)** — алгоритм, заменяющий последовательности повторяющихся символов на пары "количество + символ".

**Кодирование Хаффмана** — алгоритм, присваивающий часто встречающимся символам короткие коды, а редким — длинные.

**LZW** — словарный алгоритм сжатия, строящий таблицу повторяющихся последовательностей в процессе работы.

**Deflate** — комбинация LZ77 и кодирования Хаффмана, используется в ZIP, GZIP, PNG.

**LZMA** — мощный алгоритм сжатия, используемый в 7-Zip и XZ.

**JPEG** — стандарт сжатия изображений с потерями, основанный на дискретном косинусном преобразовании.

**MP3** — стандарт сжатия аудио с потерями, использующий психоакустическую модель.

**H.264 (AVC)** — стандарт сжатия видео, использующий межкадровое предсказание и внутрикадровое сжатие.

**Квантование** — процесс округления значений для уменьшения точности (и объёма данных).

**Психоакустическая модель** — модель восприятия звука человеком, используемая для определения неслышимых частот.

## Контрольные вопросы для самопроверки

1. **Файл размером 80 МБ сжат до 10 МБ. Вычислите степень сжатия и коэффициент сжатия. Во сколько раз уменьшился файл?**

2. **Объясните разницу между сжатием без потерь и с потерями. Приведите по 3 примера форматов каждого типа и укажите, для каких данных они используются.**

3. **Сожмите строку "AAAABBBBCCCC" алгоритмом RLE. Вычислите степень сжатия (считайте, что исходные символы занимают по 1 байту, а в сжатом виде пара "число+символ" тоже 2 байта).**

4. **Почему JPEG плохо подходит для сжатия скриншотов с текстом, но хорош для фотографий? Какой формат лучше использовать для скриншотов и почему?**

5. **У вас есть видеофайл в формате H.264 размером 500 МБ. Вы архивируете его в ZIP — размер архива получился 502 МБ. Объясните, почему сжатие не сработало и даже увеличило размер.**

6. **Практическая задача**: У вас есть аудиофайл WAV (стерео, 44.1 кГц, 16 бит, 4 минуты). Вычислите его размер без сжатия. Затем оцените размер после сжатия в MP3 с битрейтом 192 кбит/с. Какова степень сжатия?

## Связь с другими главами

Материал этой главы связан со следующими темами:

- [**[Глава 1.3](01_03_представление_звуковых_данных.md)**](01_03_представление_звуковых_данных.md) (Представление звуковых данных): форматы MP3, AAC, Opus используют сжатие с потерями
- [**[Глава 1.4](01_04_представление_символьных_данных.md)**](01_04_представление_символьных_данных.md) (Представление символьных данных): кодировки UTF-8 содержат элементы сжатия
- [**[Глава 1.5](01_05_меры_информации.md)**](01_05_меры_информации.md) (Меры информации): энтропия Шеннона определяет теоретический предел сжатия
- [**[Глава 1.8](01_08_представление_графических_данных.md)**](01_08_представление_графических_данных.md) (Представление графических данных): форматы JPEG, PNG, GIF, WebP используют различные алгоритмы сжатия
- **Раздел 8** (Сети): HTTP-сжатие (GZIP, Brotli) ускоряет загрузку сайтов

## Резюме

В этой главе мы разобрали способы сжатия информации:

- ✅ Два типа сжатия: **без потерь** (для данных, где важен каждый бит) и **с потерями** (для мультимедиа)
- ✅ Алгоритмы без потерь: **RLE** (простой), **Хаффман** (классика), **LZW** (словарный), **Deflate** (ZIP/GZIP), **LZMA** (7-Zip)
- ✅ Алгоритмы с потерями: **JPEG** (фото), **MP3/AAC/Opus** (аудио), **H.264/H.265** (видео)
- ✅ Степень сжатия и коэффициент сжатия как метрики эффективности
- ✅ Практическое применение: когда какой формат использовать
- ✅ Ограничения: нельзя сжать всё подряд, случайные данные не сжимаются

Теперь ты знаешь:

- Какой формат выбрать для разных типов данных
- Почему JPEG превращает мемы в кашу после пересохранения
- Как рассчитать степень сжатия
- Что не все данные можно сжать (и почему архивирование архива — плохая идея)
- Что сжатие — это всегда компромисс между размером, качеством и скоростью

Сжатие данных — это фундаментальная технология, без которой современный интернет был бы невозможен. Представь, что каждая фотка в Instagram весила бы 30 МБ, а фильм — 200 ГБ. Спасибо алгоритмам сжатия, что этого не происходит.

---

_Объём главы: ~15000 символов_


---

[← К оглавлению](README.md)

*Глава 1.12: Способы сжатия информации*
