[← К оглавлению](README.md)

---

# [Глава 9.4](09_04_противодействие_нарушениям.md). Противодействие нарушению конфиденциальности

## Введение: Защищаем конфиденциальность, пока хакеры не добрались до твоих котиков

Окей, дружище, в [главе 9.03](09_03_понятия_иб_угрозы.md) мы разобрали, **какие угрозы** существуют (внутренние/внешние, природные, техногенные), в [главе 9.01](09_01_политика_безопасности.md) составили **политику безопасности**, в [главе 9.02](09_02_криптографические_методы.md) научились **шифровать данные**. Теперь вопрос: **а как на практике защитить конфиденциальность?**

**Конфиденциальность** — это первая буква в **CIA Triad** (Confidentiality, Integrity, Availability). Цель: **секретные данные видят только те, кому положено**. Не соседи по Wi-Fi, не хакеры, не инсайдеры, не спецслужбы (ну, иногда и спецслужбы, но это уже другой уровень параноии).

**Реальность**:
- **3.2 миллиарда паролей** украдены в 2021 году (отчёт Cybersecurity Ventures)
- **60%** утечек данных — из-за **слабых или украденных паролей**
- Средний срок обнаружения утечки данных: **207 дней** (IBM, 2023) — хакеры сидят в твоей системе полгода, а ты даже не в курсе
- **82%** утечек данных — из-за **человеческого фактора** (случайная отправка email не тому человеку, клик на фишинг, слабый пароль)

**Почему важно защищать конфиденциальность?**

1. **Финансовые потери**: Equifax заплатила **$700 млн штрафов** за утечку 147 млн записей
2. **Репутация**: После утечки клиенты уходят к конкурентам
3. **Юридические проблемы**: GDPR (Европа) и 152-ФЗ (Россия) — штрафы до **4% годового оборота** за утечку персональных данных
4. **Личная безопасность**: Утекли медицинские записи → страховая компания отказывает в полисе; утекли номера карт → списали деньги

**В этой главе мы разберём:**
- Шифрование данных (at rest, in transit, in use)
- Контроль доступа (RBAC, MFA, биометрия)
- DLP (Data Loss Prevention) — предотвращение утечек
- Мониторинг и логирование (SIEM, форензика)
- Обучение персонала (фишинг, пароли)
- Организационные меры (NDA, водяные знаки)
- Физическая безопасность (защита дата-центров)
- Резервное копирование (зашифрованный backup)

Эта глава связана с:
- **Главой 9.01 (Политика безопасности)** — тут мы реализуем политику на практике
- **Главой 9.02 (Криптография)** — используем шифрование как основной метод защиты
- **Главой 9.03 (Угрозы ИБ)** — защищаемся от угроз конфиденциальности (перехват трафика, инсайдеры, фишинг)
- **Главой 9.05 (Атаки)** — защита от конкретных атак (MITM, phishing, социальная инженерия)
- **Главой 8.04 (Протоколы Internet)** — HTTPS, SSH, VPN для защиты трафика

---

## 9.4.1. Шифрование данных: Главная линия обороны

Первое правило защиты конфиденциальности: **ШИФРУЙ ВСЁ**. Серьёзно. Диски, базы данных, трафик, backup, мессенджеры, облачные хранилища — всё.

**Почему?** Потому что если хакер украдёт зашифрованный диск — он получит набор случайных байтов. Без ключа эти данные бесполезны (ну, если ты не используешь пароль `123456` для шифрования, конечно).

---

### Шифрование в покое (Data at Rest)

**Определение**: Шифрование данных, которые **хранятся** на диске, в БД, на флешке, в облаке.

**Зачем?** Чтобы при краже устройства (ноутбук, сервер, жёсткий диск) или при физическом доступе (кто-то зашёл в серверную) данные остались недоступными.

---

#### Шифрование диска (Full Disk Encryption, FDE)

**Как работает:** Весь диск шифруется одним ключом. При загрузке ОС запрашивает пароль → расшифровывает загрузочный сектор → ОС работает с расшифрованными данными в оперативной памяти.

**Популярные решения:**

1. **BitLocker (Windows)**:
   - Встроен в Windows (Pro/Enterprise)
   - Использует **AES-128 или AES-256**
   - Ключи хранятся в **TPM** (Trusted Platform Module) — чип на материнской плате
   - Если вытащить диск из ноутбука и вставить в другой компьютер → данные не прочитать без пароля

   **Пример включения:**
   ```
   Панель управления → BitLocker → Включить BitLocker → Сохранить ключ восстановления (48-значный)
   ```

   **Проблема**: Если забыл пароль и потерял ключ восстановления → данные потеряны навсегда.

2. **LUKS (Linux Unified Key Setup)**:
   - Стандарт для Linux
   - Используется в Ubuntu, Fedora, Arch
   - Команда для шифрования раздела:
   ```bash
   # Зашифровать раздел /dev/sdb1
   cryptsetup luksFormat /dev/sdb1
   # Открыть зашифрованный раздел
   cryptsetup open /dev/sdb1 encrypted_disk
   # Теперь монтируем /dev/mapper/encrypted_disk
   mount /dev/mapper/encrypted_disk /mnt
   ```

   **Важно**: При каждой загрузке нужно вводить пароль. Если сервер перезагрузился ночью (отключили свет) → он не загрузится, пока ты не приедешь и не введёшь пароль.

3. **FileVault (macOS)**:
   - Встроен в macOS
   - Использует **XTS-AES-128**
   - Ключ привязан к логину пользователя
   - Можно разблокировать через iCloud (если забыл пароль)

---

#### Шифрование базы данных (TDE — Transparent Data Encryption)

**Зачем?** Чтобы даже если хакер украл файлы БД (например, скопировал `.mdf` файл SQL Server), он не смог прочитать данные.

**Как работает:**
- СУБД автоматически шифрует данные при записи на диск
- При чтении — автоматически расшифровывает
- Для приложения это **прозрачно** (отсюда название Transparent)

**Примеры:**
- **SQL Server**: поддерживает TDE (AES-128/256)
- **Oracle Database**: Advanced Security Option (ASO)
- **MySQL**: InnoDB Encryption (с MySQL 5.7)
- **PostgreSQL**: pgcrypto (расширение для шифрования столбцов)

**Минус TDE**: Если БД запущена — данные доступны. Защита только от кражи файлов.

---

### Шифрование в движении (Data in Transit)

**Определение**: Шифрование данных, которые **передаются** по сети (от клиента к серверу, между серверами).

**Зачем?** Чтобы при перехвате трафика (MITM-атака, сниффинг Wi-Fi) данные остались недоступными.

---

#### HTTPS (HTTP over TLS/SSL)

**Как работает** (подробности в [главе 9.02](09_02_криптографические_методы.md)):
1. Клиент (браузер) подключается к серверу
2. Сервер отправляет **SSL-сертификат** (содержит публичный ключ)
3. Браузер проверяет сертификат (подписан ли доверенным CA)
4. Генерируется **сессионный ключ** (симметричный) для шифрования трафика
5. Все данные (пароли, номера карт, cookie) шифруются **AES-256**

**Пример настройки HTTPS (Let's Encrypt)**:
```bash
# Установить Certbot (бесплатные сертификаты от Let's Encrypt)
sudo apt install certbot python3-certbot-nginx
# Получить сертификат для домена example.com
sudo certbot --nginx -d example.com
# Автоматически обновлять сертификат каждые 3 месяца
sudo systemctl enable certbot.timer
```

**Зелёный замочек в браузере**: означает, что соединение зашифровано + сертификат подтверждён.

**Важно**: HTTP (без S) — это **открытый текст**. Любой сосед по Wi-Fi может перехватить пароли с помощью Wireshark.

---

#### VPN (Virtual Private Network)

**Зачем?** Шифровать весь трафик от компьютера до VPN-сервера. Используется для:
- **Удалённой работы**: подключение к корпоративной сети из дома
- **Обход блокировок**: YouTube в Китае, Pornhub в России (после блокировок)
- **Защита в публичных Wi-Fi**: в кафе/аэропорту/отеле перехватывают трафик

**Популярные протоколы:**
1. **OpenVPN** (open-source, медленнее)
2. **WireGuard** (новый, быстрый, безопасный) — используется в Mullvad, ProtonVPN
3. **IPsec** (для корпоративных VPN)

**Пример подключения к WireGuard**:
```bash
# Установить WireGuard
sudo apt install wireguard
# Создать конфиг /etc/wireguard/wg0.conf
[Interface]
PrivateKey = <твой приватный ключ>
Address = 10.0.0.2/24

[Peer]
PublicKey = <публичный ключ сервера>
Endpoint = vpn.example.com:51820
AllowedIPs = 0.0.0.0/0  # весь трафик через VPN

# Запустить VPN
sudo wg-quick up wg0
```

**Минус VPN**: Провайдер VPN видит весь твой трафик. Если VPN-провайдер не надёжен (бесплатный VPN из Google Play) → он сам может продавать твои данные.

---

#### SSH (Secure Shell)

**Зачем?** Удалённое управление серверами. Все команды и данные шифруются.

**Как работает:**
- Используется **асимметричное шифрование** (RSA, Ed25519)
- Вместо паролей — **SSH-ключи** (публичный ключ на сервере, приватный у тебя)

**Пример настройки SSH-ключа:**
```bash
# Генерируем пару ключей
ssh-keygen -t ed25519 -C "твой_email@example.com"
# Копируем публичный ключ на сервер
ssh-copy-id user@server.com
# Теперь подключаемся без пароля
ssh user@server.com
```

**Важно**: Приватный ключ (`~/.ssh/id_ed25519`) нельзя никому показывать. Если кто-то украл твой приватный ключ → он может зайти на все твои серверы.

---

### Шифрование в использовании (Data in Use)

**Определение**: Шифрование данных **в оперативной памяти** во время обработки.

**Проблема**: Обычное шифрование защищает данные на диске и в сети, но **не в RAM**. Если хакер получил доступ к серверу (через уязвимость, физический доступ) → он может прочитать данные из памяти.

**Решение — Confidential Computing:**
- **Intel SGX** (Software Guard Extensions) — изолированная область памяти (enclave), куда даже ОС не может заглянуть
- **AMD SEV** (Secure Encrypted Virtualization) — шифрование памяти виртуальных машин
- **ARM TrustZone** — изолированная среда на мобильных устройствах

**Пример использования**: Google Cloud, Microsoft Azure используют SGX/SEV для защиты конфиденциальных вычислений (обработка медицинских данных, финансовые расчёты).

**Минус**: Сложно реализовать, требует поддержки процессора, медленнее обычной обработки.

---

## 9.4.2. Контроль доступа: Кто, что и когда может делать

Шифрование — это круто, но недостаточно. Нужно **ограничить доступ** к данным. Принцип: **не все должны видеть всё**.

---

### Принцип наименьших привилегий (Least Privilege)

**Определение**: Каждый пользователь/процесс должен иметь **минимально необходимые права** для выполнения своих задач.

**Примеры:**
- **Хорошо**: Разработчик имеет доступ к тестовой БД, но **не** к продакшн-БД
- **Плохо**: Все сотрудники имеют права администратора (admin) → один клик на вредоносный файл → ransomware зашифровал все серверы

**Реальный пример**: Colonial Pipeline (2021) — ransomware зашифровал серверы. Почему? Потому что хакеры получили **учётную запись с правами администратора** через утечку пароля. Если бы у этой учётки были ограничены права → ransomware не смог бы зашифровать критические системы.

---

### RBAC (Role-Based Access Control)

**Определение**: Права доступа назначаются **по ролям**, а не каждому пользователю отдельно.

**Пример:**
- **Роль "Бухгалтер"**: может читать финансовые отчёты, редактировать счета
- **Роль "Разработчик"**: может читать/писать код, деплоить на тестовый сервер
- **Роль "Администратор"**: может делать всё

**Преимущества:**
- Проще управлять правами (добавил нового бухгалтера → назначил роль "Бухгалтер")
- Меньше ошибок (не забудешь отозвать права при увольнении)

**Пример в Linux:**
```bash
# Создать группу "developers"
sudo groupadd developers
# Добавить пользователя в группу
sudo usermod -aG developers alice
# Назначить права на папку /var/www/project только группе developers
sudo chown -R :developers /var/www/project
sudo chmod 770 /var/www/project
```

---

### MFA (Multi-Factor Authentication) — Многофакторная аутентификация

**Определение**: Для входа требуется **два или более фактора**:
1. **Что ты знаешь**: пароль, PIN
2. **Что у тебя есть**: смартфон (Google Authenticator), USB-ключ (YubiKey)
3. **Кто ты**: биометрия (отпечаток пальца, Face ID)

**Зачем?** Если хакер украл пароль (через фишинг, утечку) → он всё равно не сможет войти без второго фактора.

**Статистика**: MFA блокирует **99.9%** автоматических атак (Microsoft, 2020).

**Примеры MFA:**
1. **TOTP** (Time-based One-Time Password):
   - Приложение: Google Authenticator, Authy, Microsoft Authenticator
   - Генерирует 6-значный код, который меняется каждые 30 секунд
   - Основан на **общем секрете** (QR-код при настройке)

   **Как работает**:
   ```
   Секрет: JBSWY3DPEHPK3PXP (base32)
   Текущее время: 1700000000 (Unix timestamp)
   Интервал: 1700000000 / 30 = 56666666 (номер интервала)
   HMAC-SHA1(секрет, 56666666) → берём последние 6 цифр → 123456
   ```

2. **SMS-коды**:
   - Код приходит на телефон
   - **Минус**: SMS можно перехватить (SIM-swapping — хакер переводит твой номер на свою SIM)

3. **Аппаратные ключи (YubiKey, Titan Security Key)**:
   - USB-устройство, которое подтверждает вход
   - **Плюс**: невозможно украсть удалённо
   - **Минус**: если потерял ключ → не войдёшь в аккаунт (нужен backup-ключ)

**Пример настройки 2FA в Linux (SSH)**:
```bash
# Установить Google Authenticator
sudo apt install libpam-google-authenticator
# Запустить настройку
google-authenticator
# Редактировать /etc/pam.d/sshd, добавить строку:
auth required pam_google_authenticator.so
# Редактировать /etc/ssh/sshd_config:
ChallengeResponseAuthentication yes
# Перезапустить SSH
sudo systemctl restart sshd
```

Теперь при входе по SSH нужен **пароль + код из Google Authenticator**.

---

### Биометрия

**Примеры:**
- **Отпечаток пальца** (Touch ID, сканер в смартфоне)
- **Распознавание лица** (Face ID, Windows Hello)
- **Сканирование радужной оболочки глаза** (в некоторых банках)
- **Голос** (Alexa, Google Assistant — используют для разблокировки)

**Плюсы:**
- Не нужно запоминать пароль
- Сложно украсть (ну, в теории)

**Минусы:**
- **Невозможно изменить**: Если хакер украл твой отпечаток пальца (скопировал с кружки) → ты не можешь "сменить пароль"
- **False positives/negatives**: Face ID иногда не распознаёт тебя (если ты побрился/надел очки/лежишь в темноте)
- **Обход**: Исследователи взломали Face ID с помощью маски (3D-принтер + фото)

**Вывод**: Биометрию лучше использовать как **второй фактор**, а не единственный.

---

## 9.4.3. DLP (Data Loss Prevention) — Предотвращение утечек

**Определение**: **Система контроля и блокировки** передачи конфиденциальных данных за пределы организации.

**Зачем?** Чтобы сотрудник не смог случайно (или специально) слить базу клиентов на личный Gmail, скопировать на флешку, распечатать на принтере.

---

### Типы DLP

1. **Network DLP** (сетевой):
   - Мониторит трафик (email, веб, FTP, облачные сервисы)
   - Блокирует отправку писем с номерами кредитных карт, паспортов, исходным кодом

   **Пример**: Сотрудник пытается отправить файл `clients.xlsx` на личный Gmail → DLP анализирует содержимое → обнаруживает номера телефонов/email → блокирует отправку + уведомляет администратора безопасности.

2. **Endpoint DLP** (на устройствах):
   - Блокирует копирование файлов на USB-флешки, внешние диски
   - Блокирует печать конфиденциальных документов
   - Делает скриншоты экрана пользователя (для расследования)

   **Пример**: Разработчик пытается скопировать папку с исходным кодом на USB → DLP блокирует + логирует попытку.

3. **Cloud DLP** (в облаке):
   - Мониторит загрузку файлов в Google Drive, Dropbox, OneDrive
   - Блокирует загрузку конфиденциальных данных в публичные облака

   **Пример**: Сотрудник загружает презентацию с пометкой "Confidential" в личный Dropbox → DLP блокирует.

---

### Методы обнаружения конфиденциальных данных

1. **Сигнатуры (регулярные выражения)**:
   - Номера кредитных карт: `\d{4}-\d{4}-\d{4}-\d{4}`
   - Номера паспортов (РФ): `\d{4} \d{6}`
   - Email: `[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}`

2. **Классификация файлов**:
   - Файлы с пометкой "Confidential", "Top Secret" автоматически блокируются
   - Проверка метаданных (например, файл создан в отделе финансов → считается конфиденциальным)

3. **Machine Learning**:
   - DLP анализирует, какие файлы обычно отправляются вне компании (пресс-релизы, публичная документация)
   - Обнаруживает аномалии: сотрудник никогда не отправлял файлы размером >100 МБ → внезапно отправляет архив 500 МБ → алерт

---

### Реальный пример DLP

**Кейс**: Крупная IT-компания (назовём её TechCorp).

**Проблема**: Увольняющиеся разработчики уносили исходный код (копировали на USB, отправляли себе на Gmail).

**Решение**:
1. Установили **Endpoint DLP** на всех рабочих ноутбуках
2. Заблокировали USB-порты (кроме клавиатуры/мыши)
3. Настроили правило: любой файл с расширением `.cpp`, `.h`, `.py` → блокировать копирование/отправку на внешние email
4. Разрешили отправку исходного кода только на корпоративный GitLab

**Результат**: За год обнаружили **12 попыток утечки** (10 случайных, 2 злонамеренных). Уволили 2 сотрудников, остальным — предупреждение.

**Стоимость DLP**: $50 000 в год (лицензия + администрирование)  
**Стоимость одной утечки исходного кода** (по оценкам): $500 000 - $5 000 000 (потеря конкурентного преимущества)

**Вывод**: Окупилось.

---

## 9.4.4. Мониторинг и логирование: Кто что делал и когда

**Принцип**: Если не логируешь — не сможешь расследовать инцидент. Если хакер украл данные 3 месяца назад — но ты не знаешь, **кто, когда и как** → ты в жопе.

---

### SIEM (Security Information and Event Management)

**Определение**: Система **сбора, анализа и корреляции** логов из всех источников (серверы, файрволы, антивирусы, приложения).

**Как работает:**
1. **Сбор логов**: агенты собирают логи с серверов, сетевых устройств, приложений
2. **Нормализация**: разные форматы логов приводятся к единому виду
3. **Корреляция**: SIEM ищет паттерны (например, 10 неудачных попыток входа за минуту → возможна brute force атака)
4. **Алерты**: уведомление администратору безопасности (email, SMS, Slack)

**Популярные SIEM:**
1. **Splunk** (коммерческий, дорогой, мощный)
2. **ELK Stack** (Elasticsearch, Logstash, Kibana) — open-source
3. **IBM QRadar** (коммерческий, для enterprise)
4. **Wazuh** (open-source, бесплатный)

---

### Пример настройки ELK Stack для мониторинга

**Задача**: Собирать логи с веб-сервера (nginx), анализировать, искать подозрительную активность.

**Шаги**:
1. **Установить Elasticsearch** (хранилище логов):
   ```bash
   sudo apt install elasticsearch
   sudo systemctl start elasticsearch
   ```

2. **Установить Logstash** (сбор и обработка логов):
   ```bash
   sudo apt install logstash
   # Конфиг /etc/logstash/conf.d/nginx.conf
   input {
     file {
       path => "/var/log/nginx/access.log"
       start_position => "beginning"
     }
   }
   filter {
     grok {
       match => { "message" => "%{COMBINEDAPACHELOG}" }
     }
   }
   output {
     elasticsearch {
       hosts => ["localhost:9200"]
     }
   }
   sudo systemctl start logstash
   ```

3. **Установить Kibana** (визуализация):
   ```bash
   sudo apt install kibana
   sudo systemctl start kibana
   # Открыть http://localhost:5601
   ```

4. **Настроить алерты**:
   - Правило: Если IP делает >100 запросов в минуту → алерт (возможен DDoS или сканирование уязвимостей)
   - Правило: Если статус 401 (Unauthorized) >10 раз за минуту с одного IP → возможна brute force атака на логин

---

### Форензика (Forensics) — Расследование после инцидента

**Определение**: Анализ логов, дампов памяти, файловой системы **после атаки**, чтобы понять:
- Как хакер проник в систему?
- Какие данные украл?
- Когда началась атака?
- Кто виноват?

**Пример расследования**:

**Кейс**: Компания обнаружила, что 50 ГБ данных клиентов исчезли с сервера.

**Шаги форензики**:
1. **Изолировать скомпрометированный сервер** (отключить от сети, но не выключать — иначе оперативная память сотрётся)
2. **Сделать дамп памяти** (RAM dump):
   ```bash
   sudo dd if=/dev/mem of=/tmp/memory.dump
   ```
3. **Проанализировать логи**:
   - Логи SSH: кто заходил и когда?
   - Логи веб-сервера: были ли подозрительные запросы (SQL-инъекции, XSS)?
   - Логи файловой системы: какие файлы изменялись/удалялись?

4. **Обнаружили**:
   - В 3:47 утра — вход по SSH с IP из Китая (но админ живёт в России)
   - IP принадлежит VPN-сервису → настоящий IP скрыт
   - Использован украденный SSH-ключ (файл `id_rsa` был украден через фишинг)
   - Хакер выполнил команду: `tar -czf /tmp/data.tar.gz /var/www/clients/*`
   - Затем загрузил архив через SCP на свой сервер
   - Удалил файл `/tmp/data.tar.gz` (чтобы скрыть следы)

5. **Выводы**:
   - Виноват: админ, который кликнул на фишинговое письмо → украли SSH-ключ
   - Решение: отозвать все SSH-ключи, включить MFA для SSH, обучить персонал распознаванию фишинга

---

## 9.4.5. Обучение персонала: Главная уязвимость — это ты

**Статистика**:
- **82%** утечек данных — из-за **человеческого фактора** (Verizon DBIR, 2023)
- **30%** сотрудников кликают на фишинговые письма
- **60%** используют одинаковый пароль для рабочих и личных аккаунтов

**Вывод**: Можно купить самый крутой firewall, установить DLP, настроить SIEM — но если сотрудник кликнет на "Ваш аккаунт заблокирован, нажмите здесь" → всё нахуй.

---

### Фишинг: Как распознать?

**Фишинг** — это письма/сообщения, которые притворяются легитимными (банк, HR-отдел, CEO), чтобы украсть пароли или заставить перевести деньги.

**Признаки фишинга:**

1. **Подозрительный отправитель**:
   - Легит: `support@paypal.com`
   - Фишинг: `support@paypa1.com` (единица вместо l), `support@paypal-secure.net`

2. **Срочность и паника**:
   - "Ваш аккаунт будет заблокирован через 24 часа!"
   - "Подозрительная активность, нажмите здесь немедленно!"

3. **Грамматические ошибки**:
   - "Ваша карта будет заблокированы" (множественное число)
   - "Уважаемое клиент" (неправильный падеж)

4. **Подозрительные ссылки**:
   - Навести мышку на ссылку → в статус-баре браузера показывает реальный URL
   - Легит: `https://paypal.com/login`
   - Фишинг: `http://paypal-login.phishingsite.com`

5. **Вложения**:
   - `.exe`, `.bat`, `.scr` — исполняемые файлы (вирусы)
   - `.docx`, `.pdf` с макросами — могут содержать вирусы

---

### Реальный пример фишинга

**Кейс**: В 2016 году хакеры взломали почту **Джона Подесты** (председатель избирательной кампании Хиллари Клинтон).

**Как?**
1. Отправили письмо: "Google обнаружил подозрительную активность, смените пароль"
2. Ссылка вела на поддельную страницу Google (`http://bit.ly/...` → перенаправление на `https://google-security.phishingsite.com`)
3. Подеста ввёл пароль → хакеры получили доступ к почте
4. Украли 50 000 писем → слили в WikiLeaks → скандал на всю Америку

**Урок**: Даже умные люди попадаются на фишинг. Нужно обучение.

---

### Симуляция фишинга

**Что это?** Компания отправляет **тестовые фишинговые письма** своим сотрудникам, чтобы проверить их бдительность.

**Пример**:
- Отправляем письмо: "HR-отдел: обновите данные для расчёта зарплаты по ссылке"
- Ссылка ведёт на внутреннюю страницу компании: "Вы попались на фишинг! Пройдите обучение"
- Кто кликнул → отправляем на обязательный тренинг

**Результат** (реальная статистика одной компании):
- **1-я симуляция**: 35% сотрудников кликнули
- **2-я симуляция** (через 3 месяца после обучения): 12% кликнули
- **3-я симуляция** (через 6 месяцев): 5% кликнули

---

### Политика паролей

**Плохие пароли** (топ-10 самых популярных паролей в 2023 году):
1. `123456`
2. `password`
3. `123456789`
4. `12345678`
5. `qwerty`
6. `abc123`
7. `111111`
8. `password1`
9. `iloveyou`
10. `admin`

**Правила хорошего пароля:**
1. **Длина**: минимум 12 символов (лучше 16+)
2. **Сложность**: буквы (заглавные + строчные) + цифры + символы
3. **Уникальность**: не использовать один пароль для разных сайтов
4. **Непредсказуемость**: не `Qwerty123!`, а `g7$mP#9vLx2@nK4Z`

**Проблема**: Невозможно запомнить 50 сложных паролей.

**Решение — Менеджеры паролей:**
- **1Password**, **Bitwarden**, **KeePassXC** (open-source)
- Хранят пароли в **зашифрованном хранилище** (AES-256)
- Нужно запомнить только **один мастер-пароль**
- Генерируют случайные пароли (например, `hJ8#mV$9xLp2@qR5`)

**Пример использования Bitwarden**:
```bash
# Установить Bitwarden CLI
npm install -g @bitwarden/cli
# Войти
bw login email@example.com
# Сохранить новый пароль
bw create item --name "GitHub" --username "alice" --password "g7$mP#9vLx2@nK4Z" --url "https://github.com"
# Получить пароль
bw get password GitHub
```

---

## 9.4.6. Организационные меры: Политика, договоры, процедуры

Техника — это хорошо, но нужны ещё **правила игры**.

---

### NDA (Non-Disclosure Agreement) — Договор о неразглашении

**Что это?** Юридический документ, который запрещает сотруднику/подрядчику разглашать конфиденциальную информацию.

**Когда подписывается:**
- При приёме на работу
- Перед началом проекта (для подрядчиков)
- При увольнении (чтобы не слил данные конкурентам)

**Что происходит при нарушении?**
- Штраф (например, $100 000)
- Увольнение
- Судебное преследование

**Реальный пример**: Инженер Tesla в 2018 году слил внутренние данные журналистам → Tesla подала в суд → суд обязал выплатить $167 миллионов убытков.

---

### Водяные знаки (Watermarking)

**Зачем?** Чтобы отследить, **кто именно** слил документ.

**Как работает:**
- Каждому сотруднику выдаётся PDF с **уникальным водяным знаком** (невидимым или видимым)
- Если документ утёк → по водяному знаку находим, кто слил

**Пример**:
- Сотрудник А получает документ с невидимым водяным знаком: `ID:A4F2E9`
- Сотрудник Б получает документ с водяным знаком: `ID:B7G3X1`
- Документ публикуется на форуме → извлекаем водяной знак → виноват сотрудник Б

**Технология**: Стеганография (скрытие данных в изображениях, PDF).

---

### Need-to-know principle — Принцип "нужно знать"

**Определение**: Доступ к информации предоставляется **только тем, кому это необходимо для работы**.

**Пример:**
- Разработчик знает структуру БД, но **не видит** реальные данные клиентов
- Бухгалтер видит зарплаты сотрудников, но **не видит** исходный код
- Поддержка видит логи приложения, но **не видит** финансовые отчёты

---

### Exit interview — Процедура при увольнении

**Что делать, когда сотрудник увольняется:**
1. **Отключить доступы**:
   - Корпоративная почта
   - VPN
   - SSH-ключи
   - Доступ к GitHub/GitLab
   - Облачные сервисы (AWS, Google Cloud)

2. **Забрать устройства**:
   - Ноутбук, телефон (если корпоративные)
   - USB-ключи, смарт-карты

3. **Удалённо стереть данные**:
   - Если сотрудник работал на личном ноутбуке (BYOD — Bring Your Own Device) → использовать MDM (Mobile Device Management) для удалённого стирания корпоративных данных

4. **Провести проверку**:
   - Не скопировал ли сотрудник конфиденциальные данные перед увольнением?
   - DLP-логи: были ли попытки скачать большие объёмы данных за последние 2 недели?

**Реальный пример**: Сотрудник Google в 2019 году за неделю до увольнения скачал **14 000 файлов** с исходным кодом, переписку, документы. Затем устроился в конкурирующий стартап. Google подала в суд → суд обязал вернуть данные + штраф.

---

## 9.4.7. Физическая безопасность: Защита железа

Можно настроить самый крутой firewall, но если хакер **физически** зайдёт в серверную → game over.

---

### Контроль доступа в дата-центры

**Меры безопасности:**
1. **Пропускная система**: магнитные карты, биометрия (отпечаток пальца, сканирование радужки)
2. **Охрана**: 24/7 охрана, видеонаблюдение
3. **Мантрэп (mantrap)**: двойная дверь — нельзя открыть вторую, пока не закрылась первая (чтобы нельзя было "проскочить" за легитимным сотрудником)
4. **Клетки (cages)**: каждый клиент (компания) имеет отдельную клетку с замком

**Пример**: Дата-центр Equinix (крупнейший в мире) — чтобы попасть к серверам, нужно пройти:
- Регистрация на входе + проверка паспорта
- Магнитная карта для входа в здание
- Второй уровень: биометрия (отпечаток пальца)
- Третий уровень: клетка с кодовым замком
- Видеонаблюдение на всех этапах

---

### Защита от кражи устройств

**Проблема**: Украли ноутбук → все данные доступны (если диск не зашифрован).

**Решение:**
1. **Шифрование диска** (BitLocker, LUKS, FileVault) — см. раздел 9.4.1
2. **Удалённая блокировка/стирание**:
   - **Find My Device (Windows)**: можно удалённо заблокировать или стереть ноутбук
   - **Find My Mac (macOS)**: аналогично
   - **MDM (Mobile Device Management)** для корпоративных устройств

**Пример настройки Find My Device (Windows)**:
```
Настройки → Конфиденциальность и безопасность → Find My Device → Включить
```

Если ноутбук украли → зайти на https://account.microsoft.com/devices → "Удалённое стирание".

---

### Clean Desk Policy — Чистый стол

**Правило**: Не оставляй конфиденциальные документы на столе, когда уходишь.

**Почему?**
- Уборщица может сфотографировать документ
- Посетитель (клиент, подрядчик) может увидеть конфиденциальные данные на мониторе

**Меры:**
- Блокировка компьютера (Win+L) при выходе из-за стола
- Документы убираются в запирающийся шкаф

---

## 9.4.8. Резервное копирование (Backup): План Б на случай всего

**Связь с конфиденциальностью**: Если хакер украл данные, хотя бы не потерять их. Но **важно**: backup тоже нужно шифровать, иначе хакер украдёт резервные копии.

---

### Правило 3-2-1

**Правило резервного копирования**:
- **3** копии данных (оригинал + 2 backup)
- **2** разных типа носителей (например, SSD + облако)
- **1** копия **offsite** (за пределами офиса, чтобы при пожаре/потопе не потерять все копии)

**Пример:**
- Оригинал: данные на сервере в офисе
- Backup 1: копия на внешнем жёстком диске (в офисе)
- Backup 2: копия в облаке (AWS S3, Google Cloud Storage) — **зашифрованная**

---

### Шифрование backup

**Проблема**: Хакер украл резервные копии → если они не зашифрованы, он получил все данные.

**Реальный пример**: В 2022 году **LastPass** (менеджер паролей) был взломан. Хакеры украли:
- Исходный код
- **Зашифрованные хранилища паролей клиентов** (backup из облачного хранилища)

**Почему это плохо?** Хранилища зашифрованы мастер-паролем пользователя. Если пользователь использовал слабый мастер-пароль (`qwerty123`) → хакер может подобрать его и расшифровать все пароли.

**Вывод**: Backup нужно шифровать **отдельным ключом**, который хранится **не в том же месте**, где backup.

**Пример настройки зашифрованного backup (Linux → AWS S3)**:
```bash
# Создать backup БД
mysqldump -u root -p mydb > /tmp/mydb.sql
# Зашифровать (GPG с паролем)
gpg --symmetric --cipher-algo AES256 /tmp/mydb.sql
# Загрузить в S3
aws s3 cp /tmp/mydb.sql.gpg s3://my-backup-bucket/mydb-2025-01-14.sql.gpg
# Удалить локальную копию
rm /tmp/mydb.sql /tmp/mydb.sql.gpg
```

Теперь даже если хакер получит доступ к S3 → без пароля для GPG он не расшифрует backup.

---

## 9.4.9. Реальные примеры защиты конфиденциальности

---

### Apple: End-to-End шифрование в iCloud

**Что сделали:**
- В 2022 году Apple внедрила **Advanced Data Protection** для iCloud:
  - Фото, заметки, резервные копии iPhone шифруются **end-to-end**
  - Ключ хранится **только на устройствах пользователя**, Apple не имеет доступа
  - Даже если Apple получит судебный запрос от правительства → не сможет расшифровать данные

**Минус**: Если потерял все устройства Apple + забыл пароль → данные потеряны навсегда.

---

### Google: Advanced Protection Program

**Что это?** Программа защиты для журналистов, политиков, активистов (тех, кого особенно хотят взломать).

**Меры:**
- Обязательная **аппаратная MFA** (YubiKey) — нельзя войти без USB-ключа
- Блокировка сторонних приложений (можно использовать только официальные приложения Google)
- Усиленная проверка подозрительных входов

**Результат**: За 5 лет ни один участник программы не был взломан.

---

### Пример провала: LastPass (2022)

**Что произошло:**
- Хакеры взломали ноутбук **одного из инженеров** (через вредоносное ПО)
- Получили доступ к **корпоративному хранилищу** (AWS S3)
- Украли:
  - Исходный код
  - **Зашифрованные резервные копии хранилищ паролей клиентов**

**Проблема:**
- Backup не имел **дополнительного шифрования** (кроме мастер-пароля пользователя)
- Многие пользователи использовали **слабые мастер-пароли** → хакеры смогли их подобрать

**Урок:**
1. Backup нужно шифровать **отдельным ключом** (не тем же, что основные данные)
2. Инженеры должны использовать **отдельные устройства** для работы (не личные ноутбуки)
3. **MFA для всех сотрудников** (особенно тех, у кого доступ к критическим системам)

---

## Ключевые термины

| Термин | Определение |
|--------|-------------|
| **Data at Rest** | Данные, которые **хранятся** на диске, в БД, в облаке |
| **Data in Transit** | Данные, которые **передаются** по сети |
| **Data in Use** | Данные, которые **обрабатываются** в оперативной памяти |
| **FDE** (Full Disk Encryption) | Шифрование всего диска (BitLocker, LUKS, FileVault) |
| **TDE** (Transparent Data Encryption) | Автоматическое шифрование данных в БД |
| **MFA** (Multi-Factor Authentication) | Многофакторная аутентификация (пароль + код + биометрия) |
| **TOTP** | Time-based One-Time Password (коды в Google Authenticator) |
| **RBAC** | Role-Based Access Control (права доступа по ролям) |
| **Least Privilege** | Принцип наименьших привилегий (минимально необходимые права) |
| **DLP** | Data Loss Prevention (предотвращение утечек данных) |
| **SIEM** | Security Information and Event Management (анализ логов) |
| **Forensics** | Расследование инцидентов после факта |
| **NDA** | Non-Disclosure Agreement (договор о неразглашении) |
| **Clean Desk Policy** | Политика чистого стола (не оставлять документы) |
| **Backup 3-2-1** | 3 копии, 2 типа носителей, 1 offsite |

---

## Контрольные вопросы

### Теория

1. **Что такое "Data at Rest", "Data in Transit", "Data in Use"? Приведите примеры шифрования для каждого типа.**

   <details>
   <summary>Ответ</summary>

   - **Data at Rest**: хранящиеся данные (на диске, в БД) → шифрование: BitLocker (диск), TDE (БД)
   - **Data in Transit**: передающиеся данные (по сети) → шифрование: HTTPS (TLS), VPN, SSH
   - **Data in Use**: обрабатываемые данные (в RAM) → шифрование: Intel SGX, AMD SEV

   </details>

2. **Что такое MFA (многофакторная аутентификация)? Назовите три типа факторов. Почему SMS-коды считаются менее безопасными, чем TOTP?**

   <details>
   <summary>Ответ</summary>

   **MFA** — для входа требуется 2+ фактора:
   1. Что ты знаешь (пароль, PIN)
   2. Что у тебя есть (смартфон, YubiKey)
   3. Кто ты (биометрия: отпечаток, Face ID)

   **SMS** менее безопасен, чем **TOTP**, потому что:
   - SMS можно перехватить (SIM-swapping: хакер переводит твой номер на свою SIM-карту)
   - TOTP генерируется локально на устройстве, не передаётся по сети

   </details>

3. **Что такое DLP (Data Loss Prevention)? Назовите три типа DLP. Приведите пример, когда DLP блокирует утечку.**

   <details>
   <summary>Ответ</summary>

   **DLP** — система предотвращения утечек конфиденциальных данных.

   **Типы:**
   1. **Network DLP**: мониторит трафик (email, веб) → блокирует отправку конфиденциальных данных
   2. **Endpoint DLP**: блокирует копирование на USB, печать
   3. **Cloud DLP**: блокирует загрузку конфиденциальных данных в публичные облака

   **Пример**: Сотрудник пытается отправить файл `clients.xlsx` на личный Gmail → DLP обнаруживает номера телефонов/email → блокирует отправку + логирует попытку.

   </details>

4. **Что такое SIEM? Как он помогает обнаружить атаку? Приведите пример алерта.**

   <details>
   <summary>Ответ</summary>

   **SIEM** (Security Information and Event Management) — система сбора и анализа логов из всех источников (серверы, файрволы, приложения).

   **Как помогает:**
   - Собирает логи → нормализует → ищет паттерны → генерирует алерты

   **Пример алерта:**
   - Правило: 10 неудачных попыток входа за минуту с одного IP → алерт "Возможная brute force атака" → администратор блокирует IP

   </details>

5. **Что такое принцип наименьших привилегий (Least Privilege)? Приведите пример, как его нарушение привело к инциденту.**

   <details>
   <summary>Ответ</summary>

   **Least Privilege**: каждый пользователь/процесс должен иметь **минимально необходимые права**.

   **Пример нарушения:**
   - **Colonial Pipeline (2021)**: ransomware зашифровал серверы. Почему? Учётная запись, через которую зашли хакеры, имела **права администратора**. Если бы права были ограничены → ransomware не смог бы зашифровать критические системы.

   </details>

---

### Практические задачи

6. **Задача**: Компания хочет защитить конфиденциальные данные клиентов (150 ГБ). Предложите комплексное решение (шифрование, контроль доступа, backup).

   <details>
   <summary>Решение</summary>

   1. **Шифрование**:
      - **Data at Rest**: TDE для БД (AES-256)
      - **Data in Transit**: HTTPS (TLS 1.3) для веб-приложения, VPN для удалённых сотрудников
      - **Data in Use**: если критично → Intel SGX

   2. **Контроль доступа**:
      - RBAC: роль "Аналитик данных" — только чтение, роль "Администратор БД" — полный доступ
      - MFA для всех сотрудников (TOTP или YubiKey)
      - Принцип Least Privilege: разработчики видят только тестовые данные, не продакшн

   3. **DLP**:
      - Endpoint DLP: блокировать копирование БД на USB
      - Network DLP: блокировать отправку файлов с email/телефонами клиентов на внешние email

   4. **Мониторинг**:
      - SIEM: логировать все запросы к БД, алерты при массовом скачивании данных

   5. **Backup**:
      - Правило 3-2-1: оригинал (сервер) + backup на внешнем диске (зашифрован GPG) + backup в AWS S3 (зашифрован отдельным ключом)
      - Offsite backup: S3 в другом регионе

   **Стоимость** (ориентировочно):
   - TDE для БД: встроено в SQL Server Enterprise (лицензия ~$7000)
   - DLP: ~$50 000/год (Symantec DLP)
   - SIEM: ELK Stack (бесплатно, но нужен администратор ~$100 000/год зарплата)
   - Backup: AWS S3 (150 ГБ × 3 копии = 450 ГБ) → $10/месяц

   **Итого**: ~$200 000 в год (DLP + зарплата SIEM-администратора + лицензии)

   </details>

7. **Задача**: Сотрудник жалуется, что его заставляют использовать пароль из 16 символов + MFA, и это неудобно. Объясните, почему это необходимо. Посчитайте, сколько времени потребуется подобрать пароль длиной 8 символов vs 16 символов (brute force).

   <details>
   <summary>Решение</summary>

   **Почему необходимо:**
   - **60%** утечек данных — из-за слабых или украденных паролей
   - MFA блокирует **99.9%** автоматических атак

   **Расчёт времени подбора пароля (brute force)**:

   **Дано:**
   - Алфавит: 26 букв (a-z) + 26 букв (A-Z) + 10 цифр (0-9) + 32 символа (!@#$...) = 94 символа
   - Скорость подбора: 10 миллиардов паролей/секунду (современная GPU: NVIDIA RTX 4090)

   **Пароль 8 символов:**
   - Количество вариантов: 94^8 ≈ 6 × 10^15
   - Время подбора: 6 × 10^15 / 10^10 = 600 000 секунд ≈ **7 дней**

   **Пароль 16 символов:**
   - Количество вариантов: 94^16 ≈ 3.7 × 10^31
   - Время подбора: 3.7 × 10^31 / 10^10 = 3.7 × 10^21 секунд ≈ **117 миллиардов лет**

   **Вывод**: Пароль 16 символов невозможно подобрать brute force.

   **Но**: Если пароль утёк (фишинг, утечка БД) → нужен MFA, иначе хакер войдёт без подбора.

   </details>

8. **Задача**: Компания обнаружила, что 50 ГБ данных исчезли с сервера. Какие логи нужно проанализировать для расследования? Какие следы может оставить хакер?

   <details>
   <summary>Решение</summary>

   **Логи для анализа:**
   1. **Логи SSH/RDP**: кто заходил и когда? С каких IP?
   2. **Логи веб-сервера** (nginx/Apache): были ли подозрительные запросы (SQL-инъекции, попытки взлома)?
   3. **Логи файловой системы** (auditd в Linux): какие файлы читались/копировались/удалялись?
   4. **Логи сетевого трафика** (firewall, IDS): были ли исходящие соединения на большие объёмы данных?
   5. **Логи БД**: кто выполнял запросы SELECT/DUMP?

   **Следы хакера:**
   - История команд: `~/.bash_history` (если хакер не удалил)
   - Временные файлы: `/tmp/data.tar.gz` (архив для кражи)
   - Сетевые соединения: `netstat -an` (активные соединения на момент атаки)
   - Изменённые файлы: `find / -mtime -7` (файлы, изменённые за последние 7 дней)

   **Пример расследования:**
   - Логи SSH: вход с IP из Китая в 3:47 утра
   - История команд: `tar -czf /tmp/backup.tar.gz /var/www/data/*`
   - Логи firewall: исходящее соединение на 50 ГБ на IP `185.xxx.xxx.xxx` (принадлежит VPN)
   - Вывод: хакер украл SSH-ключ → зашёл → запаковал данные → скачал через SCP

   </details>

9. **Задача**: Вы получили письмо: "Ваш аккаунт PayPal будет заблокирован через 24 часа. Подтвердите данные по ссылке: `http://paypal-security.net/verify`". Как определить, что это фишинг?

   <details>
   <summary>Решение</summary>

   **Признаки фишинга:**
   1. **Домен**: `paypal-security.net` — не официальный домен PayPal (должен быть `paypal.com`)
   2. **Протокол**: `http://` (без S) — не зашифрован, PayPal всегда использует HTTPS
   3. **Срочность**: "через 24 часа" — создаёт панику, заставляет действовать не думая
   4. **Ссылка**: настоящий PayPal никогда не просит подтверждать данные по ссылке в письме

   **Что делать:**
   - **НЕ КЛИКАТЬ** на ссылку
   - Зайти на `https://paypal.com` напрямую (ввести в браузере, не через письмо)
   - Проверить уведомления в аккаунте PayPal
   - Сообщить о фишинге: `phishing@paypal.com`

   </details>

10. **Задача**: Настройте зашифрованный backup БД MySQL на сервере Ubuntu. Backup должен загружаться в AWS S3 и быть зашифрован. Напишите bash-скрипт.

    <details>
    <summary>Решение</summary>

    ```bash
    #!/bin/bash
    # Скрипт для зашифрованного backup MySQL → AWS S3

    # Переменные
    DB_NAME="mydb"
    DB_USER="root"
    DB_PASSWORD="ваш_пароль"
    BACKUP_DIR="/tmp"
    DATE=$(date +%Y-%m-%d)
    BACKUP_FILE="$BACKUP_DIR/$DB_NAME-$DATE.sql"
    ENCRYPTED_FILE="$BACKUP_FILE.gpg"
    S3_BUCKET="s3://my-backup-bucket"
    GPG_PASSWORD="ваш_пароль_для_шифрования"

    # 1. Создать дамп БД
    echo "Создаём backup БД $DB_NAME..."
    mysqldump -u $DB_USER -p$DB_PASSWORD $DB_NAME > $BACKUP_FILE

    # 2. Зашифровать (AES-256)
    echo "Шифруем backup..."
    gpg --batch --yes --passphrase "$GPG_PASSWORD" --symmetric --cipher-algo AES256 $BACKUP_FILE

    # 3. Загрузить в S3
    echo "Загружаем в S3..."
    aws s3 cp $ENCRYPTED_FILE $S3_BUCKET/

    # 4. Удалить локальные копии
    echo "Удаляем локальные файлы..."
    rm $BACKUP_FILE $ENCRYPTED_FILE

    echo "Backup завершён: $S3_BUCKET/$DB_NAME-$DATE.sql.gpg"
    ```

    **Настройка cron для автоматического backup каждый день в 3:00**:
    ```bash
    crontab -e
    # Добавить строку:
    0 3 * * * /root/backup.sh >> /var/log/backup.log 2>&1
    ```

    **Восстановление backup**:
    ```bash
    # Скачать из S3
    aws s3 cp s3://my-backup-bucket/mydb-2025-01-14.sql.gpg /tmp/
    # Расшифровать
    gpg --batch --yes --passphrase "ваш_пароль_для_шифрования" --decrypt /tmp/mydb-2025-01-14.sql.gpg > /tmp/mydb.sql
    # Восстановить БД
    mysql -u root -p mydb < /tmp/mydb.sql
    ```

    </details>

---

## Итоги главы

**Что запомнить:**

1. **Шифруй всё**: диски (BitLocker/LUKS), трафик (HTTPS/VPN/SSH), backup (GPG)
2. **Контроль доступа**: RBAC (роли), MFA (99.9% защита), Least Privilege (минимум прав)
3. **DLP**: блокируй утечки (USB, email, облако)
4. **Мониторинг**: SIEM (анализ логов), алерты, форензика
5. **Обучай персонал**: фишинг, пароли (менеджеры паролей), симуляция
6. **Организационные меры**: NDA, водяные знаки, exit interview
7. **Физическая безопасность**: дата-центры (биометрия, клетки), шифрование ноутбуков
8. **Backup**: 3-2-1 (3 копии, 2 носителя, 1 offsite), шифрование

**Главное правило**: Защита конфиденциальности — это **многослойная оборона** (defense in depth). Если один слой пробили (украли пароль) → остальные слои (MFA, DLP, мониторинг) должны остановить атаку.

**Следующая глава**: **9.05 Способы нарушения конфиденциальности. Атаки** — разберём конкретные атаки (фишинг, социальная инженерия, MITM, keyloggers), которые противодействие из этой главы должно остановить.


---

[← К оглавлению](README.md)

*Глава 9.4: . Противодействие нарушению конфиденциальности*
